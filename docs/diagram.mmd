%%{init: {
  "theme": "base",
  "themeVariables": {
    "fontFamily": "Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial",
    "primaryTextColor": "#0f172a",
    "lineColor": "#334155",
    "fontSize": "14px"
  }
}}%%

flowchart LR

%% =====================
%% ChatAgent — Chess Demo (System Overview)
%% =====================

%% CLIENT
subgraph CLIENT[Client — Web Browser]
  A["Angular Frontend<br/>Chess Agent Demo"]
  B["ngx-chess-board<br/>Component"]
  B --> A
end

%% BACKEND
subgraph BACKEND[Backend — FastAPI]
  C0["POST /api/v1/chat"]
  C1["GET /api/v1/moves/:fen"]
  C2["GET /api/v1/evaluate/:fen"]
  C3["GET /api/v1/vector-search"]
  C4["GET /api/v1/videos/:opening"]
  C5["GET /api/v1/health"]
end

%% LLM ORCHESTRATION
subgraph ORCHESTRATION[LLM Orchestration]
  M["MCP Orchestrator<br/>(tool router)"]
  L["LLM Provider<br/>(model)"]
  M -->|prompt| L
end

%% SERVICES / INTEGRATIONS
subgraph SERVICES[Services & Integrations]
  T1["Chess Engine<br/>Stockfish + Lichess eval"]
  T2["Vector Search<br/>Milvus + Embeddings"]
  T3["YouTube Search<br/>YouTube Data API"]
  T4["System / Monitoring"]
  YT["External: YouTube Data API"]
end

%% STORAGE
subgraph DATA[Persistent Storage]
  D1[("Milvus vector index")]
  D2[("MinIO object storage")]
  D3[("etcd metadata store")]
end

%% CLIENT -> BACKEND
A -->|HTTP| C0
A -->|HTTP| C1
A -->|HTTP| C2
A -->|HTTP| C3
A -->|HTTP| C4
A -->|HTTP| C5

%% BACKEND -> LLM ORCHESTRATION
C0 --> M

%% BACKEND -> SERVICES
C1 --> T1
C2 --> T1
C3 --> T2
C4 --> T3
C5 --> T4

%% SERVICES -> STORAGE / EXTERNAL
T2 --> D1
T2 -. uses .-> D2
T2 -. uses .-> D3
T3 --> YT

%% ORCHESTRATOR TOOL CALLS (DASHED)
M -. tool calls .- T1
M -. tool calls .- T2
M -. tool calls .- T3
M -. ops .- T4

%% =====================
%% Styling
%% =====================
classDef client fill:#eef2ff,stroke:#4f46e5,stroke-width:1.5px,color:#0f172a;
classDef backend fill:#ecfeff,stroke:#0891b2,stroke-width:1.5px,color:#0f172a;
classDef service fill:#f0fdf4,stroke:#16a34a,stroke-width:1.5px,color:#0f172a;
classDef data fill:#fff7ed,stroke:#f97316,stroke-width:1.5px,color:#0f172a;
classDef optional fill:#fdf2f8,stroke:#db2777,stroke-width:1.5px,color:#0f172a,stroke-dasharray:4 3;
classDef llm fill:#fdf2f8,stroke:#db2777,stroke-width:1.5px,color:#0f172a;

class A,B client;
class C0,C1,C2,C3,C4,C5 backend;
class T1,T2,T3,T4,YT service;
class D1,D2,D3 data;
class M,L llm;
